<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Pro System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        :root {
            --gold: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%);
            --bg: #050505; --card-bg: #0d0d0d; --text-gold: #fcf6ba;
        }
        body {
            font-family: 'Tajawal', sans-serif; background-color: var(--bg);
            background-image: radial-gradient(circle at top left, #1a1a1a, #050505);
            color: #f8fafc; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px;
        }
        .form-card {
            background: var(--card-bg); border: 1px solid rgba(191, 149, 63, 0.3);
            border-radius: 30px; padding: 30px; width: 100%; max-width: 500px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.9); position: relative;
        }
        #adminPanel {
            display: none; background: #0f0f0f; border: 2px solid #bf953f;
            padding: 20px; border-radius: 20px; position: absolute;
            top: 5px; left: 5px; right: 5px; z-index: 2000; max-height: 90vh; overflow-y: auto;
        }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .header { text-align: center; margin-bottom: 25px; cursor: pointer; }
        .header h1 { 
            font-size: 32px; font-weight: 900; margin: 0;
            background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .copy-box { 
            background: rgba(191, 149, 63, 0.08); padding: 15px; border-radius: 15px; 
            border: 1px dashed #bf953f; margin-top: 15px; font-size: 14px;
        }
        .input-group { margin-bottom: 15px; text-align: right; }
        label { display: block; margin-bottom: 5px; font-size: 13px; color: var(--text-gold); font-weight: bold; }
        input, select {
            width: 100%; background: #151515; border: 1px solid rgba(191, 149, 63, 0.2);
            border-radius: 10px; padding: 10px; color: white; box-sizing: border-box; outline: none; font-family: 'Tajawal';
        }
        .calc-box { background: rgba(191, 149, 63, 0.05); padding: 15px; border-radius: 15px; text-align: center; margin: 15px 0; border: 1px solid rgba(191, 149, 63, 0.1); }
        .calc-value { font-size: 22px; font-weight: 700; color: #fff; }
        button#submitBtn {
            width: 100%; padding: 16px; background: var(--gold);
            border: none; border-radius: 12px; color: #000; font-size: 18px; font-weight: 700; cursor: pointer;
        }
        .admin-save-btn { background: var(--gold); color: #000; padding: 10px; border: none; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #invoiceOverlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; align-items: center; justify-content: center; }
        .invoice-box { background: #0d0d0d; width: 90%; max-width: 380px; padding: 25px; border-radius: 25px; border: 2px solid #bf953f; text-align: center; }
    </style>
</head>
<body>

<div class="form-card">
    <div id="adminPanel">
        <h2 style="color:gold; text-align:center; margin-top:0;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <div class="input-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><input type="text" id="set_main_title"></div>
        <div class="input-group"><label>Ù†Øµ Ø§Ù„ØªØ­Ø°ÙŠØ±</label><input type="text" id="set_warn_text"></div>
        <div class="admin-grid">
            <div class="input-group"><label>ID Ø§Ù„Ø³Ø­Ø¨</label><input type="text" id="set_admin_id"></div>
            <div class="input-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</label><input type="text" id="set_admin_name"></div>
        </div>
        <h4 style="color:gold; margin:10px 0;">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø®Ø§Ù†Ø§Øª</h4>
        <div class="admin-grid">
            <div class="input-group"><label>Ø®Ø§Ù†Ø© Ø§Ù„Ø£ÙŠØ¯ÙŠ</label><input type="text" id="set_lbl_uid"></div>
            <div class="input-group"><label>Ø®Ø§Ù†Ø© Ø§Ù„ÙˆÙƒÙŠÙ„</label><input type="text" id="set_lbl_agent"></div>
        </div>
        <h4 style="color:gold; margin:10px 0;">Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù</h4>
        <div class="admin-grid">
            <div class="input-group"><label>ÙÙˆØ¯Ø§ÙÙˆÙ†</label><input type="number" step="0.1" id="rate_voda"></div>
            <div class="input-group"><label>Ø§ØªØµØ§Ù„Ø§Øª</label><input type="number" step="0.1" id="rate_eti"></div>
            <div class="input-group"><label>Ø£ÙˆØ±Ù†Ø¬</label><input type="number" step="0.1" id="rate_ora"></div>
            <div class="input-group"><label>ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„</label><input type="number" step="0.1" id="rate_agent"></div>
        </div>
        <button class="admin-save-btn" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…</button>
        <button onclick="document.getElementById('adminPanel').style.display='none'" style="width:100%; background:transparent; color:gray; border:none; margin-top:10px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="header" onclick="checkAdmin()">
        <h1 id="disp_title">Helmy Card ğŸ”—</h1>
        <span id="disp_warn" style="color:#ff4d4d; font-size:12px; font-weight:bold; display:block; margin-top:5px;"></span>
        <div class="copy-box" onclick="copyId()">
            ID Ø³Ø­Ø¨: <b id="disp_admin_id">800050</b><br>
            Ø§Ù„Ø§Ø³Ù…: <b id="disp_admin_name">Helmy fire</b><br>
            <small>Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ù„Ù†Ø³Ø® ğŸ‘†</small>
        </div>
    </div>

    <div class="input-group"><label id="lbl_uid">ğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ</label><input type="text" id="user_id"></div>
    <div class="input-group"><label id="lbl_agent">ğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„</label><input type="text" id="agent_name"></div>

    <div class="input-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
        <select id="method" onchange="calculate()">
            <option value="ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
            <option value="Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´">Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´</option>
            <option value="Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´">Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´</option>
            <option value="ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„">ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„ (Ø³Ø¹Ø± Ø®Ø§Øµ)</option>
        </select>
    </div>

    <div class="input-group">
        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</label>
        <input type="number" id="dollars" placeholder="0.00" oninput="calculate()">
    </div>

    <div class="calc-box"><div class="calc-value" id="res-egp">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0.00 Ø¬.Ù…</div></div>

    <div class="input-group"><label>Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label><input type="text" id="wallet" placeholder="01xxxxxxxxx"></div>
    <div class="input-group"><label>ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</label><input type="file" id="screenshot" accept="image/*"></div>

    <button onclick="submitForm()" id="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
</div>

<div id="invoiceOverlay">
    <div class="invoice-box">
        <h2 style="color:gold">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…</h2>
        <div id="invoice_details" style="text-align:right; font-size:14px; color:#ccc; line-height:1.8;"></div>
        <button onclick="location.reload()" class="admin-save-btn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    let config = {
        title: "Helmy Card ğŸ”—",
        warn: "ÙŠØ³ØªØºØ±Ù‚ ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ§Ø±Ø¬Øª ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ 24 Ø³Ø§Ø¹Ø©",
        adminId: "800050", adminName: "Helmy fire",
        lblUid: "ğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ", lblAgent: "ğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„",
        rates: { voda: 45, eti: 45, ora: 45, agent: 46.5 }
    };

    const SHEET_URL = 'https://sheetdb.io/api/v1/5t77aw7docius?sheet=Karak chat';
    const TG_TOKEN = "8493256102:AAFuFPixyivycVPImhz7dMAtpcP0-NsZMpk";
    const TG_CHAT_ID = "7054064246";

    window.onload = function() {
        const saved = localStorage.getItem('helmy_final_cfg');
        if(saved) config = JSON.parse(saved);
        applyConfig();
    };

    function applyConfig() {
        document.getElementById('disp_title').innerText = config.title;
        document.getElementById('disp_warn').innerText = config.warn;
        document.getElementById('disp_admin_id').innerText = config.adminId;
        document.getElementById('disp_admin_name').innerText = config.adminName;
        document.getElementById('lbl_uid').innerText = config.lblUid;
        document.getElementById('lbl_agent').innerText = config.lblAgent;
        
        document.getElementById('set_main_title').value = config.title;
        document.getElementById('set_warn_text').value = config.warn;
        document.getElementById('set_admin_id').value = config.adminId;
        document.getElementById('set_admin_name').value = config.adminName;
        document.getElementById('set_lbl_uid').value = config.lblUid;
        document.getElementById('set_lbl_agent').value = config.lblAgent;
        document.getElementById('rate_voda').value = config.rates.voda;
        document.getElementById('rate_eti').value = config.rates.eti;
        document.getElementById('rate_ora').value = config.rates.ora;
        document.getElementById('rate_agent').value = config.rates.agent;
        calculate();
    }

    function checkAdmin() { if(prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:") === "1997") document.getElementById('adminPanel').style.display = 'block'; }

    function saveSettings() {
        config.title = document.getElementById('set_main_title').value;
        config.warn = document.getElementById('set_warn_text').value;
        config.adminId = document.getElementById('set_admin_id').value;
        config.adminName = document.getElementById('set_admin_name').value;
        config.lblUid = document.getElementById('set_lbl_uid').value;
        config.lblAgent = document.getElementById('set_lbl_agent').value;
        config.rates.voda = parseFloat(document.getElementById('rate_voda').value);
        config.rates.eti = parseFloat(document.getElementById('rate_eti').value);
        config.rates.ora = parseFloat(document.getElementById('rate_ora').value);
        config.rates.agent = parseFloat(document.getElementById('rate_agent').value);
        localStorage.setItem('helmy_final_cfg', JSON.stringify(config));
        applyConfig();
        document.getElementById('adminPanel').style.display = 'none';
    }

    function calculate() {
        const usd = document.getElementById('dollars').value || 0;
        const m = document.getElementById('method').value;
        let r = config.rates.voda;
        if(m.includes("Ø§ØªØµØ§Ù„Ø§Øª")) r = config.rates.eti;
        else if(m.includes("Ø£ÙˆØ±Ù†Ø¬")) r = config.rates.ora;
        else if(m.includes("Ø§Ù„ÙˆÙƒÙŠÙ„")) r = config.rates.agent;
        document.getElementById('res-egp').innerText = "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + (usd * r).toFixed(2) + " Ø¬.Ù…";
    }

    async function submitForm() {
        const btn = document.getElementById('submitBtn');
        const uid = document.getElementById('user_id').value;
        const agent = document.getElementById('agent_name').value || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
        const usdValue = document.getElementById('dollars').value;
        const wallet = document.getElementById('wallet').value;
        const photo = document.getElementById('screenshot').files[0];
        const method = document.getElementById('method').value;

        if(!uid || !usdValue || !wallet || !photo) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");

        btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...";

        try {
            let rate = config.rates.voda;
            if(method.includes("Ø§ØªØµØ§Ù„Ø§Øª")) rate = config.rates.eti;
            else if(method.includes("Ø£ÙˆØ±Ù†Ø¬")) rate = config.rates.ora;
            else if(method.includes("Ø§Ù„ÙˆÙƒÙŠÙ„")) rate = config.rates.agent;

            const egpVal = (usdValue * rate).toFixed(2);
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-GB');
            const timeStr = now.toLocaleTimeString('ar-EG');

            // 1. Ø¥Ø±Ø³Ø§Ù„ ØªÙ„ÙŠØ¬Ø±Ø§Ù… (ÙƒØ§Ù…Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„)
            const msg = `ğŸ§¾ *Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯*\n\nğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${uid}\nğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ${agent}\nğŸ’µ Ø¯ÙˆÙ„Ø§Ø±: ${usdValue}$\nğŸ‡ªğŸ‡¬ Ù…ØµØ±ÙŠ: ${egpVal} Ø¬.Ù…\nğŸ’³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: ${method}\nğŸ¦ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${wallet}\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateStr} ${timeStr}`;
            const formData = new FormData();
            formData.append('chat_id', TG_CHAT_ID);
            formData.append('photo', photo);
            formData.append('caption', msg);
            formData.append('parse_mode', 'Markdown');
            await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendPhoto`, { method: 'POST', body: formData });

            // 2. Ø¥Ø±Ø³Ø§Ù„ SheetDB (ØªØ£ÙƒØ¯ Ø£Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„Ø´ÙŠØª ØªØ·Ø§Ø¨Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡)
            await fetch(SHEET_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ data: [{ 
                    "Ø§Ù„Ø£ÙŠØ¯ÙŠ": uid, 
                    "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„": agent,
                    "Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±": usdValue + " $",
                    "Ø§Ù„Ù…ØµØ±ÙŠ": egpVal + " Ø¬.Ù…",
                    "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨": method,
                    "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©": "'" + wallet,
                    "Ø§Ù„ØªØ§Ø±ÙŠØ®": dateStr + " " + timeStr
                }]})
            });

            document.getElementById('invoice_details').innerHTML = `<b>ID:</b> ${uid}<br><b>Ø§Ù„ÙˆÙƒÙŠÙ„:</b> ${agent}<br><b>Ø§Ù„Ù…Ø¨Ù„Øº:</b> ${egpVal} Ø¬.Ù…<br><b>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©:</b> ${method}<br><b>Ø§Ù„ÙˆÙ‚Øª:</b> ${dateStr}`;
            document.getElementById('invoiceOverlay').style.display = 'flex';
        } catch(e) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€";
        }
    }

    function copyId() { navigator.clipboard.writeText(config.adminId); alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø£ÙŠØ¯ÙŠ âœ…"); }
</script>
</body>
</html>
